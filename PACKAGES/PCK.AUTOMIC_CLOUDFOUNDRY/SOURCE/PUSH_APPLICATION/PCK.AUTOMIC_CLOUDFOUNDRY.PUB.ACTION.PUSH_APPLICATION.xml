<?xml version="1.0" encoding="UTF-8"?>
<jobp>
   <metadata>
      <row>
         <version>21.0.0</version>
      </row>
   </metadata>
   <general_attributes>
      <row>
         <minimum_ae_version>11.2</minimum_ae_version>
         <auto_deactivation>F</auto_deactivation>
         <child_flags>00000000000000000000000000000000</child_flags>
         <deactivation_condition>ANY_OK</deactivation_condition>
         <workflow_children>3</workflow_children>
         <last_runtimes>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</last_runtimes>
         <max_parallel_action>1</max_parallel_action>
         <mrt_time>000000</mrt_time>
         <name>PCK.AUTOMIC_CLOUDFOUNDRY.PUB.ACTION.PUSH_APPLICATION</name>
         <has_prompts>1</has_prompts>
         <type>JOBP</type>
         <inherit_output_filter>N</inherit_output_filter>
         <queue>CLIENT_QUEUE</queue>
         <description>Push an existing application to Cloud Foundry</description>
         <versioning_id>959808489</versioning_id>
      </row>
   </general_attributes>
   <documentation>
      <row>
         <Docu><![CDATA[= Action name =
PCK.AUTOMIC_CLOUDFOUNDRY.PUB.ACTION.PUSH_APPLICATION

= General description =
This action is used to push an application to Cloud Foundry for the user associated to the provided authentication token. It allows a user to deploy a single application to Cloud Foundry or deploy multiple application using a manifest file.
If, for the given timeout parameter, the app does not start by the timeout limit that you have set, Cloud Foundry stops trying to start the app. Ensure, that you give sufficient time to start for large applications. The other point to note is, if the user does not give the 'buildpack', Cloud Foundry automatically detects the buildpack and if the average time taken to push is not more, and detecting a buildpack against the given app takes time, so, before the Cloud Foundry can detect further, the push is triggered failing with an "Unable to detect a supported application type" error. 
* First, it transfers the authentication information to a temporary directory('using runid' of the task) created inside agent OS temp directory. If the Authentication token is valid we call the push action to deploy an application.
* Upon successful response of the above command, it updates the authentication information in the VARA "PCK.AUTOMIC_CLOUDFOUNDRY.PRV.VARA.AUTHINFO".
* Finally, it removes the temporary directory from the agent OS using post conditions.

= Failure Conditions =
* If the specified authentication token is invalid.
* If the specified inputs are invalid.

= Inputs =
* Authentication Token	: Specify authentication token which was created after login. Example 0001241035
* Application name 	: Specify name of application. It is case insensitive. Example MyAppName
* Manifest Path 	: Specify manifest file location with filename and extension. To ignore manifest file, leave field empty. Example C:/myapp/manifest.yml
* Path to content 	: Path to directory or to a zip file which contains application content. Example C:/cloudfoundry/myapp
* Docker Image 		: Specify docker image to be used as application content. Example user/docker-image-name
* Buildpack 		: Specify either already uploaded buildback or GIT url. It is case sensitive. Example java_builpack
* Stack 		: A stack is a pre-built file system, including an operating system, that can run apps. It is case sensitive. Example cflinuxfs2 or lucid64
* Routing 		: Specify domain or hostname(sub-domain) fields according to your selection. Example: Map to hostname
* Domain 		: Specify own domain name to route. It is case insensitive. Example automic.com
* Hostname 		: Specify sub-domain (hostname) to route. If not specified and hostname mapping was selected then application name will be used as a hostname. It is case insensitive. Example MyApplication
* Instances 		: Specify number of instances. Example 5
* Disk Limit 		: Specify disk limit in Megabytes (M) or Gigabytes (G). Example 512M or 2GB
* Memory Limit 		: Specify memory limit in Megabytes (M) or Gigabytes (G) Example 512M or 2GB
* Start after pushing 	: Select 'Yes' to start application either with startup command or default start command. Example Yes, No
* Startup Command 	: Specify startup command if other than default one. Example bundle exec rails s -p $PORT
* Start Timeout 	: Specify start timeout in seconds.
* Health check type 	: Specify if you want to change type of health check. Example Port, None

= Behavior =
(none)

=Return Value=
(none)

= Outputs =
* Return code is 0 in case of success.
* Return code is non zero in case of failure.

= Logging =
Logs will be displayed in the AE report.

= Example =
(none)]]></Docu>
      </row>
   </documentation>
   <workflow_attributes>
      <row>
         <activation_at_runtime>1</activation_at_runtime>
         <reuse_agent_group>1</reuse_agent_group>
      </row>
   </workflow_attributes>
   <workflow_definitions>
      <row>
         <active>1</active>
         <childflags>0000000000000000</childflags>
         <column>1</column>
         <line_number>1</line_number>
         <mrt_time>000000</mrt_time>
         <object_name>START</object_name>
         <object_type><![CDATA[<START>]]></object_type>
         <row>1</row>
         <precondition_error_action>S</precondition_error_action>
      </row>
      <row>
         <active>1</active>
         <alias>PUSH_APPLICATION</alias>
         <childflags>0010000000000000</childflags>
         <column>2</column>
         <line_number>2</line_number>
         <mrt_time>000000</mrt_time>
         <object_name>PCK.AUTOMIC_CLOUDFOUNDRY.PRV.JOB.PUSH_APPLICATION@GENERIC</object_name>
         <object_type>JOBS</object_type>
         <has_postconditions>1</has_postconditions>
         <predecessors>1</predecessors>
         <postcondition_action>1</postcondition_action>
         <rollback_enabled>1</rollback_enabled>
         <row>1</row>
         <precondition_error_action>A</precondition_error_action>
      </row>
      <row>
         <active>1</active>
         <childflags>0000000000000000</childflags>
         <column>3</column>
         <line_number>3</line_number>
         <mrt_time>000000</mrt_time>
         <object_name>END</object_name>
         <object_type><![CDATA[<END>]]></object_type>
         <predecessors>1</predecessors>
         <row>1</row>
         <precondition_error_action>A</precondition_error_action>
      </row>
   </workflow_definitions>
   <line_conditions>
      <row>
         <workflow_line_number>2</workflow_line_number>
         <line_number>1</line_number>
         <predecessor_line_number>1</predecessor_line_number>
         <ok_status>ANY_OK</ok_status>
      </row>
      <row>
         <workflow_line_number>3</workflow_line_number>
         <line_number>1</line_number>
         <predecessor_line_number>2</predecessor_line_number>
         <ok_status>ANY_OK</ok_status>
      </row>
   </line_conditions>
   <conditions>
      <row>
         <active>1</active>
         <name>EXECUTE OBJECT</name>
         <workflow_line_number>2</workflow_line_number>
         <condition_line_number>1</condition_line_number>
         <execution_time>2</execution_time>
         <type>A</type>
      </row>
   </conditions>
   <condition_values>
      <row>
         <condition_link_line_number>1</condition_link_line_number>
         <workflow_line_number>2</workflow_line_number>
         <execution_time>2</execution_time>
         <type>V</type>
         <value>PCK.AUTOMIC_FILESYSTEM.PUB.ACTION.DELETE</value>
         <variable>XC_P01</variable>
      </row>
      <row>
         <condition_link_line_number>1</condition_link_line_number>
         <workflow_line_number>2</workflow_line_number>
         <execution_time>2</execution_time>
         <type>S</type>
         <value>#915032:getobjprompt:0:3</value>
         <variable>XC_P02</variable>
      </row>
      <row>
         <condition_link_line_number>1</condition_link_line_number>
         <workflow_line_number>2</workflow_line_number>
         <execution_time>2</execution_time>
         <type>V</type>
         <value>##911010</value>
         <variable>XC_P03</variable>
      </row>
      <row>
         <condition_link_line_number>1</condition_link_line_number>
         <workflow_line_number>2</workflow_line_number>
         <execution_time>2</execution_time>
         <type>V</type>
         <value>DEL_DIR</value>
         <variable>XC_P04</variable>
      </row>
   </condition_values>
   <condition_parameters>
      <row>
         <condition_line_number>1</condition_line_number>
         <condition_variable_name>XC_P03</condition_variable_name>
         <workflow_line_number>2</workflow_line_number>
         <execution_time>2</execution_time>
         <value>&amp;AGENT#</value>
         <prompt_set_variable>AGENT#</prompt_set_variable>
      </row>
      <row>
         <condition_line_number>1</condition_line_number>
         <condition_variable_name>XC_P03</condition_variable_name>
         <workflow_line_number>2</workflow_line_number>
         <execution_time>2</execution_time>
         <value>&amp;LOGIN#</value>
         <prompt_set_variable>LOGIN#</prompt_set_variable>
      </row>
      <row>
         <condition_line_number>1</condition_line_number>
         <condition_variable_name>XC_P03</condition_variable_name>
         <workflow_line_number>2</workflow_line_number>
         <execution_time>2</execution_time>
         <value>NO</value>
         <prompt_set_variable>UC4RB_DIR_FILE_RM_FAIL#</prompt_set_variable>
      </row>
      <row>
         <condition_line_number>1</condition_line_number>
         <condition_variable_name>XC_P03</condition_variable_name>
         <workflow_line_number>2</workflow_line_number>
         <execution_time>2</execution_time>
         <value>&amp;UC4RB_CF_HOMEDIR#</value>
         <prompt_set_variable>UC4RB_DIR_FILE_RM_NAME#</prompt_set_variable>
      </row>
   </condition_parameters>
   <prompt_set_list>
      <row>
         <line_number>1</line_number>
         <prompt_set>PCK.AUTOMIC_CLOUDFOUNDRY.PUB.PROMPTSET.AUTHENTICATION_TOKEN</prompt_set>
         <display_order>1</display_order>
      </row>
      <row>
         <line_number>2</line_number>
         <prompt_set>PCK.AUTOMIC_CLOUDFOUNDRY.PRV.PROMPTSET.PUSH_APPLICATION</prompt_set>
         <display_order>2</display_order>
      </row>
      <row>
         <line_number>3</line_number>
         <prompt_set>PCK.ITPA_SHARED.PRV.PROMPTSET.OVERWRITE_AGENT</prompt_set>
         <display_order>3</display_order>
      </row>
   </prompt_set_list>
   <prompt_set_defaults>
      <row>
         <alternative_view>1</alternative_view>
         <prompt_set_element_number>1</prompt_set_element_number>
         <prompt_set>PCK.AUTOMIC_CLOUDFOUNDRY.PUB.PROMPTSET.AUTHENTICATION_TOKEN</prompt_set>
         <value>&amp;UC4RB_CF_AUTHTOKEN#</value>
         <variable_name>UC4RB_CF_AUTHTOKEN#</variable_name>
      </row>
      <row>
         <alternative_view>1</alternative_view>
         <prompt_set_element_number>3</prompt_set_element_number>
         <prompt_set>PCK.ITPA_SHARED.PRV.PROMPTSET.OVERWRITE_AGENT</prompt_set>
         <value>&amp;AGENT#</value>
         <variable_name>AGENT#</variable_name>
      </row>
      <row>
         <alternative_view>1</alternative_view>
         <prompt_set_element_number>3</prompt_set_element_number>
         <prompt_set>PCK.ITPA_SHARED.PRV.PROMPTSET.OVERWRITE_AGENT</prompt_set>
         <value>&amp;LOGIN#</value>
         <variable_name>LOGIN#</variable_name>
      </row>
   </prompt_set_defaults>
   <rollback_definitions>
      <row>
      </row>
   </rollback_definitions>
</jobp>
