<?xml version="1.0" encoding="UTF-8"?>
<jobi>
   <metadata>
      <row>
         <version>21.0.0</version>
      </row>
   </metadata>
   <general_attributes>
      <row>
         <minimum_ae_version>11.2</minimum_ae_version>
         <child_flags>00000000000000000000000000000000</child_flags>
         <last_runtimes>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</last_runtimes>
         <name>PCK.AUTOMIC_SSH.PUB.INCLUDE.PREPARE_CMD@WIN</name>
         <type>JOBI</type>
         <versioning_id>-337334911</versioning_id>
      </row>
   </general_attributes>
   <scripts>
      <row>
         <process><![CDATA[: SET &UC4RB_JAVA_CMD# = 'java -jar "&UC4RB_JAR_PATH#"'
: SET &UC4RB_JAVA_CMD# = STR_CAT(&UC4RB_JAVA_CMD#, " -action &ACTION_NAME#")

!SSH Host
: SET &UC4RB_ESCAPED_STRING# =&UC4RB_SSH_HOST#
: INC PCK.AUTOMIC_SSH.PUB.INCLUDE.ESCAPE_ARG_VALUE@WIN
: SET &UC4RB_JAVA_CMD# = STR_CAT(&UC4RB_JAVA_CMD#, " -sshhost &UC4RB_ESCAPED_STRING#")

!SSH Port
: SET &UC4RB_JAVA_CMD# = STR_CAT(&UC4RB_JAVA_CMD#, " -sshport &UC4RB_SSH_PORT#")

!Connection Timeout
: SET &UC4RB_JAVA_CMD# = STR_CAT(&UC4RB_JAVA_CMD#, " -conntimeout &UC4RB_SSH_CONN_TIMEOUT#")

!SSH Username
: SET &UC4RB_ESCAPED_STRING# =&UC4RB_SSH_USERNAME#
: INC PCK.AUTOMIC_SSH.PUB.INCLUDE.ESCAPE_ARG_VALUE@WIN
: SET &UC4RB_JAVA_CMD# = STR_CAT(&UC4RB_JAVA_CMD#, " -username &UC4RB_ESCAPED_STRING#")

!Strict host key check
: SET &UC4RB_JAVA_CMD# = STR_CAT(&UC4RB_JAVA_CMD#, " -hostkeycheck &UC4RB_SSH_HOST_KEY_CHECK#")

: IF &UC4RB_SSH_SUDO_OPT# EQ "Sudo"
:   SET &UC4RB_JAVA_CMD# = STR_CAT(&UC4RB_JAVA_CMD#, " -sudo &UC4RB_SSH_SUDO_OPT#")
: ENDIF

: IF &UC4RB_SSH_SUDO_PASS# NE "" OR "--10"
:   SET &UC4RB_ENCRYPTED_PASSWORD_TMP# = "&UC4RB_SSH_SUDO_PASS#"
!   Decrypt passphrase
:   INC PCK.ITPA_SHARED.PRV.INCLUDE.DECRYPT_PASSWORD
    set UC4_DECRYPTED_SUDO_PASS=%UC4_DECRYPTED_PWD%
: ENDIF

!Check for password and private key
:SET &COUNT# = 0

:IF &UC4RB_SSH_KEY# NE ""
:  SET &COUNT# = &COUNT# + 1
:ENDIF

:IF &UC4RB_SSH_PASSWORD# NE "" OR "--10"
:  SET &COUNT# = &COUNT# + 1
: ENDIF

:IF &COUNT# EQ 0 OR 2
:       STOP MSG, 50, "Please provide either private key or password"
:ENDIF

: IF &UC4RB_SSH_KEY# NE ""
:   SET &UC4RB_ESCAPED_STRING# =&UC4RB_SSH_KEY#
:   INC PCK.AUTOMIC_SSH.PUB.INCLUDE.ESCAPE_ARG_VALUE@WIN
:   SET &UC4RB_JAVA_CMD# = STR_CAT(&UC4RB_JAVA_CMD#, " -sshkey &UC4RB_ESCAPED_STRING#")

:   IF &UC4RB_SSH_PASSPHRASE# NE "" OR "--10"
:     SET &UC4RB_ENCRYPTED_PASSWORD_TMP# = "&UC4RB_SSH_PASSPHRASE#"
!     Decrypt passphrase
:     INC PCK.ITPA_SHARED.PRV.INCLUDE.DECRYPT_PASSWORD
      set UC4_DECRYPTED_PASSPHRASE=%UC4_DECRYPTED_PWD%
:   ENDIF
: ELSE
!  Password
:  INC PCK.ITPA_SHARED.PUB.INCLUDE.ATTACH
:  SET &UC4RB_ENCRYPTED_PASSWORD_TMP# = "&UC4RB_SSH_PASSWORD#"
:  INC PCK.ITPA_SHARED.PRV.INCLUDE.DECRYPT_PASSWORD
: ENDIF

]]></process>
      </row>
   </scripts>
</jobi>
